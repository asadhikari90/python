name: Veracode-Test in linux

on:
  push:
    branches:
      - main
 #  pull_request:1
   # types: [opened, synchronize, reopened]

jobs:
  build:
    name: Veracode Testing
    runs-on: ubuntu-latest #Can be parametized if needed
    steps:

      - run: sudo apt-get update -y && sudo apt-get install curl -y
      - run: sudo apt-get install jq -y

     # - name: Install Veracode CLI
     # - run: |
     #     curl -O https://downloads.veracode.com/securityscan/VeracodeJavaAPI.jar
     #     curl -O https://downloads.veracode.com/securityscan/VeracodeJavaWrapper.zip
     #     unzip -o VeracodeJavaWrapper.zip -d veracode
     #     rm VeracodeJavaWrapper.zip
            

      - name: Set up Python
        uses: actions/setup-python@v2
        with:
          python-version: 3.x

      - run: zip -r veracode-scan-target.zip python/publish
      - run: | 
            ls python/publish
            echo break
            ls python/publish/
            echo break
            pwd
            ls $GITHUB_WORKSPACE
      - name: Veracode Upload And Scan
        uses: veracode/veracode-uploadandscan-action@0.2.6
        with:
          appname: 'DemoApp'
          createprofile: true
          filepath: $GITHUB_WORKSPACE/veracode-scan-target.zip
          vid: '${{ secrets.VID }}'
          vkey: '${{ secrets.VKEY }}'
          sandboxName: 'DemoSandbox1'
